#!/bin/bash


BUILD_DIR="build"
NAME="indicator-virtual-box"
VERSION=1.0.34
PYTHON_UTILS=../PythonUtils/src/pythonutils.py

if [ ! -f $PYTHON_UTILS ];
then
    echo "$PYTHON_UTILS not found - ABORTING!" && exit 0
fi

rm -rf $BUILD_DIR

mkdir -p $BUILD_DIR/$NAME-$VERSION
cp $NAME.desktop $BUILD_DIR/$NAME-$VERSION
cp build-debian $BUILD_DIR/$NAME-$VERSION

mkdir -p $BUILD_DIR/$NAME-$VERSION/src
cp src/indicator-virtual-box.py src/virtualmachine.py $BUILD_DIR/$NAME-$VERSION/src
cp $PYTHON_UTILS $BUILD_DIR/$NAME-$VERSION/src

mkdir -p $BUILD_DIR/$NAME-$VERSION/icons/elementary
cp icons/indicator-virtual-box-elementary.svg $BUILD_DIR/$NAME-$VERSION/icons/elementary/indicator-virtual-box.svg

mkdir -p $BUILD_DIR/$NAME-$VERSION/icons/hicolor
cp icons/indicator-virtual-box-hicolor.svg $BUILD_DIR/$NAME-$VERSION/icons/hicolor/indicator-virtual-box.svg

mkdir -p $BUILD_DIR/$NAME-$VERSION/icons/lubuntu
cp icons/indicator-virtual-box-lubuntu.svg $BUILD_DIR/$NAME-$VERSION/icons/lubuntu/indicator-virtual-box.svg

mkdir -p $BUILD_DIR/$NAME-$VERSION/icons/ubuntu-mono-dark
cp icons/indicator-virtual-box-ubuntu-mono-dark.svg $BUILD_DIR/$NAME-$VERSION/icons/ubuntu-mono-dark/indicator-virtual-box.svg

mkdir -p $BUILD_DIR/$NAME-$VERSION/icons/ubuntu-mono-light
cp icons/indicator-virtual-box-ubuntu-mono-light.svg $BUILD_DIR/$NAME-$VERSION/icons/ubuntu-mono-light/indicator-virtual-box.svg

cd $BUILD_DIR
tar -czf "${NAME}_${VERSION}.orig.tar.gz" $NAME-$VERSION
cd ..

mkdir -p $BUILD_DIR/$NAME-$VERSION/debian
cp -r packaging/debian $BUILD_DIR/$NAME-$VERSION

cd $BUILD_DIR/$NAME-$VERSION
debuild -S -sa 
cd ..
rm -rf $NAME-$VERSION

echo "Now run from the build directory: dput ppa:thebernmeister/ppa ${NAME}_${VERSION}-1_source.changes"
